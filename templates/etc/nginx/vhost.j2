{{ ansible_managed | comment }}

{% if nginx_upstreams is defined %}
{% for upstream in nginx_upstreams %}
upstream {{ upstream['name'] }} {
{% for server in upstream['servers'] %}
    server {{ server }};
{% endfor %}
}
{% endfor %}
{% endif %}

server {
	listen {{ nginx_listen | default("80") }} default_server;
	listen {{ nginx_listen_v6 | default("[::]:80") }} default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root {{ nginx_root | default("/var/www/html") }};

	# Add index.php to the list if you are using PHP
    {% if nginx_indizes is defined %}
	index {% for i in nginx_indizes %} {{ i }} {% endfor %};
    {% else %}
    index index.html index.htm index.nginx-debian.html;
    {% endif %}

	server_name {{ nginx_server_name | default("_") }};

    {% for location in nginx_locations %}
    {% include "etc/nginx/partials/location.j2" %}

    {% endfor %}
}
